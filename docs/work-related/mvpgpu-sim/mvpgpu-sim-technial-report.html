<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MVPGPU-SIM Techincal Report &mdash; ggangliu-doc v0.01 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/_variables.scss?v=7050c318" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f6c7d6a8"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/custom.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ggangliu-doc
          </a>
              <div class="version">
                v0.01
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ai-deep-learning.html">AI (Deep Learning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ai-embedded.html">AI Embedded</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulator.html">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compiler.html">Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computer-architecture.html">Computer Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hdl.html">Hardware Description Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../open-source-project.html">Open Source Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project.html">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../work-related.html">Work-related</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ggangliu-doc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MVPGPU-SIM Techincal Report</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="mvpgpu-sim-techincal-report">
<h1>MVPGPU-SIM Techincal Report<a class="headerlink" href="#mvpgpu-sim-techincal-report" title="Link to this heading"></a></h1>
<p>[TOC]</p>
<section id="mvpgpu-sim-project-introduction">
<h2>1. MVPGPU-SIM Project Introduction<a class="headerlink" href="#mvpgpu-sim-project-introduction" title="Link to this heading"></a></h2>
<section id="project-scope">
<h3>1.1 Project Scope<a class="headerlink" href="#project-scope" title="Link to this heading"></a></h3>
<p>将立项文档中的项目需求创建为用户故事
<img alt="user story" src="../../_images/2023-10-23_111130.png" /></p>
</section>
<section id="project-flow">
<h3>1.2 Project Flow<a class="headerlink" href="#project-flow" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>制定了迭代计划
<img alt="迭代" src="../../_images/2023-10-23_110808.png" /></p></li>
<li><p>进行需求分析，根据需求创任务，输出到Product Backlog
<img alt="需求分析" src="../../_images/2023-10-23_111327.png" /></p></li>
<li><p>所有已识别出的任务（包括子任务）均创建在Product Backlog中（开发过程中会根据实际情况增删任务）
<img alt="Product backlog" src="../../_images/2023-10-23_112044.png" /></p></li>
<li><p>Sprint1从Backlog中提取优先级最高的任务，开始实施执行
<img alt="Sprint1" src="../../_images/2023-10-23_112208.png" /></p></li>
<li><p>Sprint2的任务将在Sprint1结束后从Backlog中根据优先级和计划进行提取</p></li>
<li><p>Sprint3依次类推</p></li>
</ol>
</section>
<section id="schedule-overview">
<h3>1.3 Schedule Overview<a class="headerlink" href="#schedule-overview" title="Link to this heading"></a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>gantt
dateFormat YYYY-MM-DD
%%axisFormat WK%W
inclusiveEndDates
todayMarker stroke-width:3px,stroke:#0f0,opacity:0.5
title &quot;MVP v3.0 Modeling Schedule&quot;

section 需求分析
  Analyze requirement                           :done, r1, 2023-08-02, 4w 
section Sprint 1
  MVP v3.0 design and exploring                  :done, t, 2023-07-01, 2w
  Report release v0.1                            :done, milestone, crit, m0, after t, 1d   
  GPC/TPC/SM/SP                                  :done, t0, after m0, 3w
  MVP v2.1 Calculation                           :done, t0.0, 2023-09-10, 4w
  SP Pipeline                                    :active, t0.1, 2023-10-10, 3w
  Register file size                             :t1, after t0, 3w
  LDST Unit                                      :done, t1-1, after t0, 3w  
  L1 Instruction Cache size                      :t2, 2023-07-28, 3w
  L1 Data Cache size                             :t3, after t2, 3w
  Local memory size                              :t4, after t3, 3w
  Report release v1.0                            :milestone, crit, m1, after t4, 1d
  L2 Cache size                                  :t5, after m1, 3w
  Bus bandwidth                                  :t6, after t5, 3w 
  DRAM                                           :t7, after t6, 3w
  Report release v2.0                            :milestone, crit, m2, after t7, 1d  
  Evaluating L3 Cache which shared by all GPCs   :t8, after m2, 3w
section Sprint 2
  PA performance and quantity                    :t9, after t8, 3w
  RAST performance and quantity                  :t10, after t9, 3w
  ROP performance and quantity                   :t11, after t10, 3w
  TEXT performance and quantity                  :t12, after t11, 3w
  Report release v3.0                            :milestone, crit, m3, after t12, 1d
section Sprint 3
  Area                                           :t13, after m3, 4w
  Power                                          :t14, after t13, 4w
  Report release v4.0                            :milestone, crit, m4, after t14, 1d
</pre></div>
</div>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>gantt
dateFormat YYYY-MM-DD
%%axisFormat WK%W
inclusiveEndDates
todayMarker stroke-width:3px,stroke:#0f0,opacity:0.5
title &quot;Memory Subsystem Schedule&quot;

section 需求分析
  Memory subsystem requirement analysis         :done, r1, 2023-09-30, 4w 
section Sprint 1
  MVP v2.1 Performance Roofline Model           :done, t0.0, 2023-08-30, 2w
  Report release v0.1                            :milestone, crit, m0, after t0.0, 1d  
  Analysis Tools AerialVision/Logfiles/etc      :done, t0, 2023-09-15, 2w
  Local Mem Implement Fit MVP RTL                :done, t1, 2023-09-30, 3w 
  LDST Unit For LD/ST Inst Pipeline Support      :done, t1-1, 2023-10-13, 3w  
  L1 Instruction Cache Fit MVP RTL               :t2, 2023-10-23, 2w
  L1 Data Cache Fit MVP RTL                      :t3, 2023-10-23, 2w
  L2 Cache Fit MVP RTL                           :t4, after t3, 2w
  Report release v1.0                            :milestone, crit, m1, after t5, 1d
section Sprint 2
  Register file Fit MVP RTL                      :t5, after t4, 3w
  DRAM                                           :t6, after t5, 3w
  Cache/DRAM/XBAR Bandwidth                      :t7, after t6, 4w 
  Report Release v2.0                            :milestone, crit, m2, after t7, 1d
  Performance Overview of the whole GPU Pipeline :t8, after m2, 2w
  Single/Multiple SP Performance                 :t9, after m2, 2w
  Memory Occupancy                               :t10, after t9, 2w
  Patent                                         :t11, after t9, 1w
  Report release v3.0                            :milestone, crit, m3, after t11, 1d
section Sprint 3
  Design L3 Cache                                :t12, after t11, 3w
  Design Tensor Core                             :t13, after t12, 3w
  Analysis Tools Support                         :t14, after t13, 3w
  Power                                          :t15, after t15, 4w
  Report release v4.0                            :milestone, crit, m4, after t15, 1d
</pre></div>
</div>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>gantt
dateFormat YYYY-MM-DD
%%axisFormat WK%W
inclusiveEndDates
todayMarker stroke-width:3px,stroke:#0f0,opacity:0.5
title &quot;SMD Developing Schedule&quot;

section 需求分析
  Requirement analysis                           :done, r1, 2023-08-02, 4w 
section Sprint 1
  SMD design and exploring                  :done, t, 2023-08-01, 2w
  Report release v0.1                            :done, milestone, crit, m0, after t, 1d   
  SMD  development documentation, writing and review                                :done, t0, after m0, 3w
  SMD development environment setup                           :done, t0.0, 2023-09-10, 4w
  mvpgpu-sim library packaging                                     :active, t0.1, 2023-10-10, 3w
  SMD code framework                            :done, t1, after t0, 3w
  UMD and SMD interface conventions                                      :active, t1, after t0, 3w  
  UMD-SMD-mvpgpu-sim calls the link up                      :t2, 2023-09-28, 3w
  SMD developing                             :t3, after t2, 3w
  SMD patent disclosure                              :t4, after t3, 3w
  Report release v1.0                            :milestone, crit, m1, after t4, 1d
  section Sprint 2
  SMD submodule unit testing                                   :t5, after m1, 3w
  SMD integration testing                                  :t6, after t5, 3w 
  Test report                                           :t7, after t6, 3w
  Report release v1.1                            :milestone, crit, m2, after t7, 1d  
section Sprint 2
section Sprint 3
  OpenCL-1.2 CTS                                           :t8, after t7, 4w
  documentation &amp; technology  sharing                                          :t9, after t8, 4w
  Report release v1.2                            :milestone, crit, m4, after t9, 1d
</pre></div>
</div>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>gantt
dateFormat YYYY-MM-DD
%%axisFormat WK%W
inclusiveEndDates
todayMarker stroke-width:3px,stroke:#0f0,opacity:0.5
title &quot;MVP-sim Graphic Schedule&quot;

section 需求分析
  Requirement analysis                           :done, r1, 2023-08-02, 4w 
section Sprint 1
  graphic cycle                                  :done, t0, after r1, 3w   
  graphic task scheduling                                  :done, t1, after t0, 3w
  scheduling of multiple graphic pipelines                           :done, t0.0, 2023-09-10, 4w
  graphic call of tpc                                     :done, t0.1, 2023-10-10, 3w
  Pomegranate algorithm                                     :done, t0.1, 2023-10-10, 3w
  mvp-isa def bug                            :done, t0.1, 2023-10-10, 1w
  graphic-related patent                   :t11, after t0, 3w
  graphic perf to aerialvision                   :t18, after t11, 3w
section Sprint 2
  Transfer umd request                    :t9, after t18, 3w
  BO and submit umd request                   :t10, after t9, 3w
  remaining umd request                  :t12, after t10, 2w
  opengl run success          :milestone, crit, m1, after t12, 1d
  new mvp isa                                            :t13, after t12, 3w
section Sprint 3
  source code view                                          :t14, after t13, 2w
  Area evaluation                                         :t15, after t14, 4w
  Interconnection                                          :t16, after t15, 4w
  pytorch on mvpgpusim                                          :t17, after t16, 4w
</pre></div>
</div>
</section>
</section>
<section id="id1">
<h2>2. 模拟器简述<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<section id="vs">
<h3>2.1 模拟vs模仿<a class="headerlink" href="#vs" title="Link to this heading"></a></h3>
<p>模拟和模仿都涉及到模仿某种行为、动作或情境，但它们在含义和程度上有所不同。下面是它们的区别：</p>
<ol class="arabic simple">
<li><p>模拟（Simulation）</p>
<ul class="simple">
<li><p>模拟是指通过模拟或模拟某种情境、过程或事件来尝试理解或重现它，通常是为了学习、训练、预测或测试目的</p></li>
<li><p>模拟通常是一个较为抽象的过程，涉及到创建一个模型或仿真环境，以便观察其在不同条件下的行为</p></li>
<li><p>模拟不一定要精确地复制原始情境，而是通过简化或抽象的方式来模拟关键特征和行为</p></li>
</ul>
</li>
<li><p>模仿（Imitation）</p>
<ul class="simple">
<li><p>模仿是指通过直接复制或模仿某人或某物的行为、动作或特征来学习或表现类似的行为</p></li>
<li><p>模仿通常是一种生物学上的学习方式，尤其在婴儿和幼儿阶段非常常见</p></li>
<li><p>模仿通常涉及到复制原始行为的外部表现，而不一定理解其内在原因或机制</p></li>
</ul>
</li>
</ol>
<p>总的来说，模拟更多地强调创建一个虚拟的模型或环境来研究和理解事物，而模仿则更强调复制行为或动作以学习或表现相似的行为</p>
</section>
<section id="id2">
<h3>2.2 如何评估一个模拟器<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">维度</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">模拟精度</td>
<td style="text-align: left;">评估模拟器模拟真实GPU行为的准确性</td>
</tr>
<tr>
<td style="text-align: left;">性能</td>
<td style="text-align: left;">考虑模拟器的运行速度和效率</td>
</tr>
<tr>
<td style="text-align: left;">支持的GPU架构</td>
<td style="text-align: left;">确保模拟器支持所需的GPU架构</td>
</tr>
<tr>
<td style="text-align: left;">可扩展性</td>
<td style="text-align: left;">评估模拟器是否易于扩展和定制</td>
</tr>
<tr>
<td style="text-align: left;">用户友好性</td>
<td style="text-align: left;">考虑模拟器的界面和易用性</td>
</tr>
<tr>
<td style="text-align: left;">支持的操作系统和平台</td>
<td style="text-align: left;">检查模拟器是否适用于特定操作系统和硬件平台</td>
</tr>
<tr>
<td style="text-align: left;">可视化和分析工具</td>
<td style="text-align: left;">是否提供可视化和分析工具以便于结果理解和可视化</td>
</tr>
<tr>
<td style="text-align: left;">文档和社区支持</td>
<td style="text-align: left;">是否有详细文档和活跃的用户社区支持</td>
</tr>
<tr>
<td style="text-align: left;">准确性验证</td>
<td style="text-align: left;">是否对模拟器的准确性进行验证，与实际硬件结果进行比较</td>
</tr>
<tr>
<td style="text-align: left;">性能分析工具</td>
<td style="text-align: left;">是否提供性能分析工具来优化GPU程序的性能</td>
</tr>
<tr>
<td style="text-align: left;">并行性和多线程支持</td>
<td style="text-align: left;">考虑模拟器是否支持多个GPU和并行计算</td>
</tr>
</tbody>
</table>
</section>
<section id="gem5gpgpu-simgpu-from-chatgpt">
<h3>2.3 GEM5和GPGPU-SIM在GPU建模方面进行了比较(from ChatGPT)<a class="headerlink" href="#gem5gpgpu-simgpu-from-chatgpt" title="Link to this heading"></a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th>特性/维度</th>
<th>GEM5</th>
<th>GPGPU-SIM</th>
</tr>
</thead>
<tbody>
<tr>
<td>设计目标</td>
<td>通用计算机系统建模</td>
<td>专注于GPU建模和仿真</td>
</tr>
<tr>
<td>用途</td>
<td>通用处理器和系统模拟</td>
<td>GPU性能分析和建模</td>
</tr>
<tr>
<td>精确度</td>
<td>一般</td>
<td>高度精确的GPU模拟</td>
</tr>
<tr>
<td>GPU架构支持</td>
<td>可以扩展支持，相对通用</td>
<td>多种GPU架构的模拟支持</td>
</tr>
<tr>
<td>社区支持</td>
<td>活跃的开源社区</td>
<td>专注于GPU建模的社区</td>
</tr>
<tr>
<td>灵活性</td>
<td>非常灵活</td>
<td>更专注于GPU</td>
</tr>
<tr>
<td>性能分析工具</td>
<td>有限的性能分析工具</td>
<td>丰富的性能分析工具</td>
</tr>
<tr>
<td>适用领域</td>
<td>通用系统模拟和研究</td>
<td>GPU性能分析、开发和研究</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>如果你需要进行通用系统模拟，并且研究涉及多个处理器架构（包括CPU和GPU）以及它们之间的互操作性，那么GEM5可能更适合，因为它具有更广泛的通用性和灵活性。</strong></p></li>
<li><p><strong>如果你的工作主要集中在GPU建模、性能分析和GPU应用程序的开发上，那么GPGPU-SIM可能更适合，因为它专注于GPU，提供高度精确的GPU模拟和丰富的性能分析工具，以满足GPU相关研究和开发的需求。</strong></p></li>
</ul>
</section>
<section id="cpu-vs-gpu">
<h3>2.4 CPU vs GPU<a class="headerlink" href="#cpu-vs-gpu" title="Link to this heading"></a></h3>
<p><img alt="cpu" src="../../_images/cpu.png" /></p>
</section>
<section id="gpgpu-sim-introduction">
<h3>2.5 GPGPU-SIM Introduction<a class="headerlink" href="#gpgpu-sim-introduction" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>模拟GPU行为： GPGPU-SIM允许用户模拟GPU的行为，包括执行内核、内存访问和其他GPU操作。通过模拟，用户可以了解GPU在执行特定工作负载时的性能表现，包括吞吐量、延迟和资源利用率等。</p></li>
<li><p>支持多种GPU架构： GPGPU-SIM支持多种不同的GPU架构，包括NVIDIA的CUDA架构和AMD的OpenCL架构等。这使得用户可以在不同的GPU平台上进行性能分析和比较。</p></li>
<li><p>配置和定制： 用户可以配置GPGPU-SIM以模拟特定的GPU配置和性能特性。这包括GPU核心数、内存大小、缓存配置等。用户还可以自定义模拟参数以适应其研究或性能测试的需求。</p></li>
<li><p>用于研究和开发： GPGPU-SIM广泛用于学术研究、GPU架构研究和GPU性能优化。它有助于了解GPU如何处理不同的工作负载，并提供洞察如何改进GPU应用程序的性能。</p></li>
<li><p>开源： GPGPU-SIM是一个开源工具，可在个人和研究项目中免费使用。它的源代码可供查看和修改，以适应特定需求。</p></li>
</ol>
</section>
</section>
<section id="mvpgpu-sim-introduction">
<h2>3. MVPGPU-SIM Introduction<a class="headerlink" href="#mvpgpu-sim-introduction" title="Link to this heading"></a></h2>
<section id="mvpgpu-sim-overview">
<h3>3.1 MVPGPU-SIM Overview<a class="headerlink" href="#mvpgpu-sim-overview" title="Link to this heading"></a></h3>
<p><img alt="MVPGPU-SIM Overview" src="../../_images/MVPGPU-SIM-Overview.png" /></p>
<section id="graphics-processing-clusters">
<h4>3.1.1 Graphics Processing Clusters<a class="headerlink" href="#graphics-processing-clusters" title="Link to this heading"></a></h4>
<p>由配置文件控制创建多少个GPC，每个GPC包括TPC、PA和RAST。且每个components的数量可配置</p>
<blockquote>
<div><p>-mvpgpu_n_gpc 1
-mvpgpu_n_pa_per_gpc 1
-mvpgpu_n_rast_per_gpc 1</p>
</div></blockquote>
</section>
<section id="texture-processing-clusters">
<h4>3.1.2 Texture Processing Clusters<a class="headerlink" href="#texture-processing-clusters" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-mvpgpu_n_tpc_per_gpc 4
-mvpgpu_n_rop_per_tpc 1
-mvpgpu_n_tex_per_tpc 1</p>
</div></blockquote>
</section>
<section id="streaming-multiprocessor">
<h4>3.1.3 Streaming Multiprocessor<a class="headerlink" href="#streaming-multiprocessor" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-mvpgpu_n_sm_per_tpc 2</p>
</div></blockquote>
</section>
<section id="streaming-processor">
<h4>3.1.4 Streaming Processor<a class="headerlink" href="#streaming-processor" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-mvpgpu_n_sp_per_sm 4
-gpgpu_stack_size_limit 1024
-gpgpu_runtime_sync_depth_limit 2
-gpgpu_runtime_pending_launch_count_limit 2048
-gpgpu_kernel_launch_latency 5000</p>
</div></blockquote>
<blockquote>
<div><p>-mvpgpu_clock_domains in MhZ
&lt;core_clock&gt;:&lt;interconnect_clock&gt;:&lt;l2_clock&gt;:&lt;dram_clock&gt;:&lt;pa_clock&gt;:&lt;rop_clock&gt;:&lt;raster_clock&gt;:&lt;texture_clock&gt;
-mvpgpu_clock_domains 1000.0:1000.0:1000.0:800.0:1000.0:1000.0:1000.0:1000.0
//This implies a maximum of 32 warps/SM n_thread_per_shader:warp_size
-mvpgpu_n_threads_per_sp_and_warp_size 32:1
-mvpgpu_num_block_per_sp 1
-mvpgpu-thdc-hthread 4
-mvpgpu-thdc-vthread 4</p>
</div></blockquote>
</section>
</section>
<section id="pipeline">
<h3>3.2 Pipeline<a class="headerlink" href="#pipeline" title="Link to this heading"></a></h3>
<p><img alt="sim" src="../../_images/mvpgpu-sim-pipeline-flow.png" /></p>
<blockquote>
<div><dl class="myst field-list simple">
<dt class="field-odd">memo<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>Note:</strong> Don’t support Register Forwarding</p>
</dd>
</dl>
</div></blockquote>
<blockquote>
<div><p>//the number of pipeline registers to be equal to the number of SP units
-mvpgpu_pipeline_widths 4,4,0,4,4,4,4,0,4,4,4,4,0,0
-gpgpu_num_fp32_units_per_sp 4
-gpgpu_num_int32_units_per_sp 4
-gpgpu_num_sfu_units_per_sp 2
-mvpgpu_num_ldst_units_per_sp 4
-gpgpu_tensor_core_avail 0
-gpgpu_num_tensor_core_units_per_sp 0
//“ADD,MAX,MUL,MAD,DIV”
-ptx_opcode_latency_int 3,3,3,3,3,3
-ptx_opcode_initiation_int 1,1,1,1,1,1
-ptx_opcode_latency_fp 3,3,3,3,3,3
-ptx_opcode_initiation_fp 1,1,1,1,1,1
-ptx_opcode_latency_dp 3,3,3,3,3,3
-ptx_opcode_initiation_dp 1,1,1,1,1,1
-ptx_opcode_latency_load 3
-ptx_opcode_initiation_load 1
-ptx_opcode_latency_sfu 6
-ptx_opcode_initiation_sfu 1
-ptx_opcode_latency_tesnor 64
-ptx_opcode_initiation_tensor 1
//scheduler: &lt; lrr | gto | two_level_active | thdc &gt;
-gpgpu_scheduler thdc</p>
</div></blockquote>
</section>
<section id="memory-subsystem">
<h3>3.3 Memory Subsystem<a class="headerlink" href="#memory-subsystem" title="Link to this heading"></a></h3>
<p><img alt="memory-subsystem" src="../../_images/mvpgpu-sim-memory-subsystem.png" /></p>
<section id="register-file">
<h4>3.3.1 Register File<a class="headerlink" href="#register-file" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_num_reg_banks 16
-gpgpu_reg_file_port_throughput 16</p>
</div></blockquote>
</section>
<section id="l1i-cache">
<h4>3.3.2 L1I Cache<a class="headerlink" href="#l1i-cache" title="Link to this heading"></a></h4>
<p>Cache structure, cache policy, MSHR, memory coalescing</p>
<div class="highlight-s notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;:&lt;</span><span class="n">nsets</span><span class="o">&gt;:&lt;</span><span class="n">block_size</span><span class="o">&gt;:&lt;</span><span class="n">assoc</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rep</span><span class="o">&gt;:&lt;</span><span class="n">wr</span><span class="o">&gt;:&lt;</span><span class="n">alloc</span><span class="o">&gt;:&lt;</span><span class="n">wr_alloc</span><span class="o">&gt;:&lt;</span><span class="n">set_index_fn</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">mshr</span><span class="o">&gt;:&lt;</span><span class="n">mshr_entry</span><span class="o">&gt;:&lt;</span><span class="n">merge</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">miss_queue</span><span class="o">&gt;:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">fifo_entries</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">data_port_width</span><span class="o">&gt;</span>
</pre></div>
</div>
<blockquote>
<div><p>-gpgpu_cache:il1 N:64:128:16,L:R:f:N:L,S:2:48,10:10,4
-gpgpu_perfect_inst_const_cache 0</p>
</div></blockquote>
</section>
<section id="l1d-cache">
<h4>3.3.3 L1D Cache<a class="headerlink" href="#l1d-cache" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_l1d_banks 8
-gpgpu_l1d_latency 0
-mvpgpu_l1d_perfect_cache 0
-gpgpu_cache:dl1  N:20:128:1,L:B:m:N:L,S:128:32,16:0,32
-gpgpu_flush_l1_cache 1
-gpgpu_gmem_skip_L1D 0</p>
</div></blockquote>
</section>
<section id="li-const-cache">
<h4>3.3.4 LI Const Cache<a class="headerlink" href="#li-const-cache" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_const_cache:l1 N:128:64:8,L:R:f:N:L,S:2:64,4</p>
</div></blockquote>
</section>
<section id="l1-text-cache">
<h4>3.3.5 L1 Text Cache<a class="headerlink" href="#l1-text-cache" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_tex_cache:l1 N:4:128:256,L:R:m:N:L,T:512:8,128:2</p>
</div></blockquote>
</section>
<section id="local-memory">
<h4>3.3.6 Local Memory<a class="headerlink" href="#local-memory" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-mvpgpu_local_mem_num_banks 8
-mvpgpu_local_mem_read_cycle 1
-mvpgpu_local_mem_write_cycle 1
-mvpgpu_local_mem_size 65536
-mvpgpu_bank_size 4096</p>
</div></blockquote>
</section>
<section id="shared-memory">
<h4>3.3.7 Shared Memory<a class="headerlink" href="#shared-memory" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_shmem_size 65536
-gpgpu_shmem_sizeDefault 65536
-gpgpu_shmem_per_block 65536
-gpgpu_smem_latency 3</p>
</div></blockquote>
</section>
<section id="l2-cache">
<h4>3.3.8 L2 Cache<a class="headerlink" href="#l2-cache" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_cache:dl2 S:64:128:16,L:B:m:L:P,A:192:4,32:0,32</p>
</div></blockquote>
</section>
<section id="dram">
<h4>3.3.9 DRAM<a class="headerlink" href="#dram" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-gpgpu_dram_partition_queues 64:64:64:64
-dram_latency 1
-gpgpu_l2_rop_latency 1
-gpgpu_dram_scheduler 1
-gpgpu_frfcfs_dram_sched_queue_size 64
-gpgpu_dram_return_queue_size 192
-gpgpu_n_mem_per_ctrlr 1
-gpgpu_dram_buswidth 2
-gpgpu_dram_burst_length 16
-dram_data_command_freq_ratio 4
-gpgpu_mem_address_mask 1
-gpgpu_mem_addr_mapping dramid&#64;8;00000000.00000000.00000000.00000000.0000RRRR.RRRRRRRR.RBBBCCCC.BCCSSSSS
//Use the same GDDR5 timing, scaled to 3500MHZ
-gpgpu_dram_timing_opt “nbk=16:CCD=4:RRD=10:RCD=20:RAS=50:RP=20:RC=62:
CL=20:WL=8:CDLR=9:WR=20:nbkgrp=4:CCDL=4:RTPL=4”</p>
</div></blockquote>
</section>
<section id="interconnection">
<h4>3.3.10 Interconnection<a class="headerlink" href="#interconnection" title="Link to this heading"></a></h4>
<blockquote>
<div><p>-network_mode 2
-icnt_in_buffer_limit 512
-icnt_out_buffer_limit 512
-icnt_subnets 2
-icnt_arbiter_algo 1
-icnt_flit_size 40</p>
</div></blockquote>
</section>
<section id="roof-line-model">
<h4>3.3.11 Roof-line Model<a class="headerlink" href="#roof-line-model" title="Link to this heading"></a></h4>
<p>Roof-line Model说的是很简单的一件事：<strong>模型在一个计算平台的限制下，到底能达到多快的浮点计算速度</strong>。更具体的来说，Roof-line Model解决的，<strong>是计算量为A且访存量为B的模型在算力为C且带宽为D的计算平台所能达到的理论性能上限E是多少</strong>这个问题</p>
<ul class="simple">
<li><p>算力决定“屋顶”的高度（绿色线段）</p></li>
<li><p>带宽决定“房檐”的斜率（红色线段）</p></li>
</ul>
<p><img alt="roofline" src="../../_images/roofline.jpg" />
<img alt="roofline1" src="../../_images/roofline01.png" /></p>
<dl class="simple myst">
<dt>模型的计算强度 I</dt><dd><p>由计算量除以访存量就可以得到模型的计算强度，它表示此模型在计算过程中，每Byte内存交换到底用于进行多少次浮点运算。单位是FLOPs/Byte。可以看到，模计算强度越大，其内存使用效率越高。</p>
</dd>
<dt>模型的理论性能 P</dt><dd><p>我们最关心的指标，即模型在计算平台上所能达到的每秒浮点运算次数（理论值）。单位是 FLOPS or FLOP/s。</p>
</dd>
</dl>
<p><strong>计算瓶颈区域 Compute-Bound</strong>
不管模型的计算强度 I 有多大，它的理论性能 P 最大只能等于计算平台的算力 π 。当模型的计算强度 I 大于计算平台的计算强度上限 Imax 时，模型在当前计算平台处于 Compute-Bound状态，即模型的理论性能 P 受到计算平台算力 π 的限制，无法与计算强度 I 成正比。但这其实并不是一件坏事，因为从充分利用计算平台算力的角度上看，此时模型已经完全利用了计算平台的全部算力。可见，计算平台的算力 π 越高，模型进入计算瓶颈区域后的理论性能 P 也就越大</p>
<p><strong>带宽瓶颈区域 Memory-Bound</strong>
当模型的计算强度 I 小于计算平台的计算强度上限 Imax 时，由于此时模型位于“房檐”区间，因此模型理论性能 P 的大小完全由计算平台的带宽上限 β （房檐的斜率）以及模型自身的计算强度 I 所决定，因此这时候就称模型处于Memory-Bound 状态。可见，在模型处于带宽瓶颈区间的前提下，计算平台的带宽 β 越大（房檐越陡），或者模型的计算强度 I 越大，模型的理论性能 P 可呈线性增长</p>
</section>
</section>
<section id="graphic">
<h3>3.4 Graphic<a class="headerlink" href="#graphic" title="Link to this heading"></a></h3>
<p>Graphics当前已经支持了PA, Raster, Texture, ROP级的性能建模支持。</p>
<blockquote>
<div><p>//pa/rop/raster/texture config
-mvpgpu_n_pa_per_gpc 1
-mvpgpu_n_rast_per_gpc 1
-mvpgpu_n_rop_per_tpc 1
-mvpgpu_n_tex_per_tpc 1
-gpu_sim_cycle_per_triangle 4078
-gpu_sim_cycle_per_point 100
-gpu_sim_cycle_per_line 100
-gpu_sim_cycle_rop 20
-gpu_sim_cycle_raster 20</p>
</div></blockquote>
<p><img alt="structure" src="../../_images/2023-10-26_140644.png" />
<img alt="schedule" src="../../_images/2023-10-26_140747.png" />
<img alt="performance" src="../../_images/2023-10-26_140842.png" />
<img alt="appl" src="../../_images/2023-10-26_140927.png" />
<img alt="result" src="../../_images/2023-10-26_141010.png" /></p>
</section>
<section id="simulator-mode-driver">
<h3>3.5 Simulator Mode Driver<a class="headerlink" href="#simulator-mode-driver" title="Link to this heading"></a></h3>
<p>复用软件栈，解决性能模拟器的软件生态问题。当前是Instruction Driven的模式，基于SMD将来有机会支持Trace driven的仿真。</p>
<p><img alt="SMD" src="../../_images/SMD-Solution.png" /></p>
</section>
<section id="visualized-performance-tool">
<h3>3.6 Visualized Performance Tool<a class="headerlink" href="#visualized-performance-tool" title="Link to this heading"></a></h3>
<p><img alt="perf tool" src="../../_images/2023-10-26_141824.png" />
<img alt="thread" src="../../_images/2023-10-26_142725.png" />
<img alt="thread_completed" src="../../_images/2023-10-26_142818.png" /></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#/mvpgpu-sim/output/l1i-perfect-l1d-cache/pipeline-analysis-sp-0.xlsx"><span class="xref myst">Cycle级的日志文件</span></a></p></li>
<li><p>单步调试的Debugger，支持逐条指令的查看执行情况（包括每个寄存器的值）
<img alt="debugger" src="../../_images/2023-10-26_143632.png" />
<img alt="info" src="../../_images/2023-10-26_144234.png" /></p></li>
</ol>
</section>
</section>
<section id="mvp-modeling">
<h2>4. MVP Modeling<a class="headerlink" href="#mvp-modeling" title="Link to this heading"></a></h2>
<section id="mvp-v2-1-modeling">
<h3>4.1 MVP V2.1 Modeling<a class="headerlink" href="#mvp-v2-1-modeling" title="Link to this heading"></a></h3>
<p>There are 4 TPCs，each TPC has 2 SMs，and each SM has 4 SPs.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>TPCs</p></th>
<th class="head text-left"><p>SMs</p></th>
<th class="head text-left"><p>SPs</p></th>
<th class="head text-left"><p>FP32 unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>4</p></td>
<td class="text-left"><p>8</p></td>
<td class="text-left"><p>32</p></td>
<td class="text-left"><p>128</p></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">PA</th>
<th style="text-align: left;">RAST</th>
<th style="text-align: left;">ROPs</th>
<th style="text-align: left;">TEXTs</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">4</td>
</tr>
</tbody>
</table>
<p><img alt="Architecture" src="../../_images/MVP-Architecture.png" /></p>
<p>Each SP contains 4 INT32 units, 4 FP32 units, 4 LD/ST units, and 2 different SFU unit for different special function.
<img alt="MVP SP Arch" src="../../_images/SP-Architecture.png" /></p>
<section id="id3">
<h4>4.1.1 Pipeline<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<p><img alt="v2.1" src="../../_images/mvp-v2.1-sp-pipeline.png" /></p>
<blockquote>
<div><dl class="myst field-list simple">
<dt class="field-odd">memo<span class="colon">:</span></dt>
<dd class="field-odd"><p>Note: Didn’t implement OCC</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="memory">
<h4>4.1.2 Memory<a class="headerlink" href="#memory" title="Link to this heading"></a></h4>
<p><img alt="memory" src="../../_images/mvp-memory-subsystem.png" /></p>
<section id="id4">
<h5>4.1.2.1 L1I Cache<a class="headerlink" href="#id4" title="Link to this heading"></a></h5>
<blockquote>
<div><p>-mvpgpu_l1i_banks 4
-mvpgpu_cache:l1i N:256:32:1,L:R:f:N:L,A:128:48,8:4,16
-gpgpu_perfect_inst_const_cache 0</p>
</div></blockquote>
</section>
<section id="id5">
<h5>4.1.2.2 L1D Cache<a class="headerlink" href="#id5" title="Link to this heading"></a></h5>
<blockquote>
<div><p>-mvpgpu_l1d_banks 4
-gpgpu_l1d_latency 0
-mvpgpu_l1d_read_latency 1
-mvpgpu_l1d_write_latency 1
-mvpgpu_l1d_perfect_cache 0
-mvpgpu_cache:l1d  N:64:32:1,L:B:m:N:L,A:256:32,16:0,32</p>
</div></blockquote>
</section>
<section id="id6">
<h5>4.1.2.3 Local Memory<a class="headerlink" href="#id6" title="Link to this heading"></a></h5>
<blockquote>
<div><p>-mvpgpu_local_mem_num_banks 8
-mvpgpu_local_mem_read_cycle 1
-mvpgpu_local_mem_write_cycle 1
-mvpgpu_local_mem_size 32768
-mvpgpu_bank_size 4096</p>
</div></blockquote>
</section>
</section>
<section id="demo">
<h4>4.1.3 Demo<a class="headerlink" href="#demo" title="Link to this heading"></a></h4>
<section id="opencl">
<h5>4.1.3.1 OpenCL<a class="headerlink" href="#opencl" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>hello</p></li>
</ul>
<div class="highlight-opencl notranslate"><div class="highlight"><pre><span></span>const char *KernelSource = &quot;\n&quot; \
&quot;__kernel void square(                                                       \n&quot; \
&quot;   __global float* input,                                              \n&quot; \
&quot;   __global float* output,                                             \n&quot; \
&quot;   const unsigned int count)                                           \n&quot; \
&quot;{                                                                      \n&quot; \
&quot;   int i = get_global_id(0);                                           \n&quot; \
&quot;   if(i &lt; count)                                                       \n&quot; \
&quot;       output[i] = input[i] * input[i];                                \n&quot; \
&quot;   else                                                                \n&quot; \
&quot;       output[i] = 0;                                                  \n&quot; \
&quot;}                                                                      \n&quot; \
&quot;\n&quot;;
</pre></div>
</div>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0000</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="no">sub$zero</span><span class="p">,</span><span class="w"> </span><span class="no">$zero</span><span class="p">,</span><span class="w"> </span><span class="no">$zero</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0008</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="no">add.si$sp</span><span class="p">,</span><span class="w"> </span><span class="no">$sp</span><span class="p">,</span><span class="w"> </span><span class="mi">-56</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0010</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="no">st.w$ra</span><span class="p">,</span><span class="w"> </span><span class="mi">52</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0018</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="no">st.w$6</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0020</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">17</span><span class="p">)</span><span class="w"> </span><span class="no">st.w$5</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0028</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="no">st.w$4</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0030</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="no">add.si$4</span><span class="p">,</span><span class="w"> </span><span class="no">$zero</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0038</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="no">jplnk_Z13get_global_idj</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0040</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">21</span><span class="p">)</span><span class="w"> </span><span class="no">fadd$3</span><span class="p">,</span><span class="w"> </span><span class="no">$zero</span><span class="p">,</span><span class="w"> </span><span class="no">$zero</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0048</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span><span class="w"> </span><span class="no">ld.w$4</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0050</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">23</span><span class="p">)</span><span class="w"> </span><span class="no">setlt.u$4</span><span class="p">,</span><span class="w"> </span><span class="no">$2</span><span class="p">,</span><span class="w"> </span><span class="no">$4</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0058</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="no">beq$4</span><span class="p">,</span><span class="w"> </span><span class="no">$zero</span><span class="p">,</span><span class="w"> </span><span class="no">.LBB0_2</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0060</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="no">jp.LBB0_1</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0068</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">27</span><span class="p">)</span><span class="w"> </span><span class="no">sfll.i$3</span><span class="p">,</span><span class="w"> </span><span class="no">$2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0070</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="no">ld.w$4</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0078</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">29</span><span class="p">)</span><span class="w"> </span><span class="no">add$3</span><span class="p">,</span><span class="w"> </span><span class="no">$4</span><span class="p">,</span><span class="w"> </span><span class="no">$3</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0080</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="no">ld.w$3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="no">$3</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0088</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">31</span><span class="p">)</span><span class="w"> </span><span class="no">fmul$3</span><span class="p">,</span><span class="w"> </span><span class="no">$3</span><span class="p">,</span><span class="w"> </span><span class="no">$3</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0090</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">33</span><span class="p">)</span><span class="w"> </span><span class="no">sfll.i$2</span><span class="p">,</span><span class="w"> </span><span class="no">$2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x0098</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">34</span><span class="p">)</span><span class="w"> </span><span class="no">ld.w$4</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x00a0</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">35</span><span class="p">)</span><span class="w"> </span><span class="no">add$2</span><span class="p">,</span><span class="w"> </span><span class="no">$4</span><span class="p">,</span><span class="w"> </span><span class="no">$2</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x00a8</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="no">st.w$3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="no">$2</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x00b0</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">37</span><span class="p">)</span><span class="w"> </span><span class="no">ld.w$ra</span><span class="p">,</span><span class="w"> </span><span class="mi">52</span><span class="p">(</span><span class="no">$sp</span><span class="p">)</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x00b8</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">38</span><span class="p">)</span><span class="w"> </span><span class="no">add.si$sp</span><span class="p">,</span><span class="w"> </span><span class="no">$sp</span><span class="p">,</span><span class="w"> </span><span class="mi">56</span>
<span class="w"> </span><span class="nf">PC</span><span class="err">=</span><span class="mi">0x00c0</span><span class="w"> </span><span class="p">(</span><span class="no">_cl_hello.s</span><span class="p">:</span><span class="mi">39</span><span class="p">)</span><span class="w"> </span><span class="no">jr$ra</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th>ALU</th>
<th>FLOPs</th>
<th>LDST.local</th>
<th>LD.global</th>
<th>ST.global</th>
<th>In total</th>
</tr>
</thead>
<tbody>
<tr>
<td>13</td>
<td>2</td>
<td>8</td>
<td>1</td>
<td>1</td>
<td>25</td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>-mvpgpu_n_gpc 1  # high level architecture configuration
-mvpgpu_n_tpc_per_gpc 4
-mvpgpu_n_sm_per_tpc 2
-mvpgpu_n_sp_per_sm 4
-mvpgpu_n_threads_per_sp_and_warp_size 32:1
-gpgpu_scheduler thdc</p>
</div></blockquote>
<section id="cache-perfect-case">
<h6>4.1.3.1.1 Cache Perfect Case<a class="headerlink" href="#cache-perfect-case" title="Link to this heading"></a></h6>
<blockquote>
<div><p>-gpgpu_perfect_inst_const_cache 1  # L1I Cache Perfect hit
-mvpgpu_l1d_perfect_cache 1        # L1D Cache Perfect hit
-mvpgpu-thdc-hthread 4
-mvpgpu-thdc-vthread 4</p>
</div></blockquote>
<p>Cycle 10/11 没有发射指令，原因在于前后指令之间的Data Hazard
<img alt="h4v4t32" src="../../_images/2023-10-24_093351.png" />
<img alt="h4v4t32-pipeline" src="../../_images/2023-10-24_102308.png" />
<img alt="h4v4t32_completed" src="../../_images/2023-10-24_094142.png" /></p>
<blockquote>
<div><p>-gpgpu_perfect_inst_const_cache 1  # L1I Cache Perfect hit
-mvpgpu_l1d_perfect_cache 1        # L1D Cache Perfect hit
-mvpgpu-thdc-hthread 4
-mvpgpu-thdc-vthread 8</p>
</div></blockquote>
<p>由于足够的线程用于调度，从而隐藏了指令之间的依赖
<img alt="h4v8t32" src="../../_images/2023-10-24_103241.png" />
<img alt="h4v8t32_completed" src="../../_images/2023-10-24_103350.png" /></p>
</section>
<section id="cache-normal-case">
<h6>4.1.3.1.2 Cache Normal Case<a class="headerlink" href="#cache-normal-case" title="Link to this heading"></a></h6>
<blockquote>
<div><p>-mvpgpu-thdc-hthread 4
-mvpgpu-thdc-vthread 8
-gpgpu_perfect_inst_const_cache 0  # L1I Cache Perfect hit
-mvpgpu_l1d_perfect_cache 0        # L1D Cache Perfect hit
-gpgpu_cache:il1 N:64:128:16,L:R:f:N:L,S:2:48,10:10,4
-gpgpu_l1d_banks 8
-gpgpu_l1d_latency 0
-gpgpu_cache:dl1  N:20:128:1,L:B:m:N:L,S:128:32,16:0,32</p>
</div></blockquote>
<p><img alt="h4v8t32-nocache" src="../../_images/2023-10-24_105225.png" />
<img alt="h4v8t32-completed" src="../../_images/2023-10-24_105414.png" /></p>
<blockquote>
<div><p>-mvpgpu-thdc-hthread 4
-mvpgpu-thdc-vthread 4</p>
</div></blockquote>
<p><img alt="h4v4t32" src="../../_images/2023-10-24_115620.png" />
<img alt="h4v4t32-completed" src="../../_images/2023-10-24_115727.png" /></p>
<p>64
<img alt="h4v4t64" src="../../_images/2023-10-24_134035.png" />
<img alt="h4v4t64-completed" src="../../_images/2023-10-24_134205.png" /></p>
</section>
</section>
<section id="graphics">
<h5>4.1.3.2 Graphics<a class="headerlink" href="#graphics" title="Link to this heading"></a></h5>
<section id="smoke-test-case">
<h6>4.1.3.2.1 Smoke test case<a class="headerlink" href="#smoke-test-case" title="Link to this heading"></a></h6>
<p>three_triangulated.obj</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3 Triangles</span>
<span class="c1"># Vertex coordinates</span>
v<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0
v<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0
v<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="m">0</span>.0
v<span class="w"> </span>-0.5<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0
v<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span>-0.5<span class="w"> </span><span class="m">0</span>.0
<span class="c1"># Texture coordinates</span>
vt<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="m">0</span>.5
vt<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span><span class="m">0</span>.0
vt<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span><span class="m">1</span>.0
vt<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span>.0
vt<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0
<span class="c1"># Normals</span>
vn<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span>.0
<span class="c1"># Triangle 1</span>
f<span class="w"> </span><span class="m">1</span>/1/1<span class="w"> </span><span class="m">2</span>/2/1<span class="w"> </span><span class="m">3</span>/3/1
<span class="c1"># Triangle 2</span>
f<span class="w"> </span><span class="m">3</span>/3/1<span class="w"> </span><span class="m">4</span>/4/1<span class="w"> </span><span class="m">1</span>/1/1
<span class="c1"># Triangle 3</span>
f<span class="w"> </span><span class="m">4</span>/4/1<span class="w"> </span><span class="m">5</span>/5/1<span class="w"> </span><span class="m">2</span>/2/1
</pre></div>
</div>
<p>Shader Program</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">frag_shader_source2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="s">&quot;(</span>
<span class="n">__kernel</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">normal_fragment_shader</span><span class="p">(</span><span class="n">__global</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">coord</span><span class="p">,</span>
<span class="w">                              </span><span class="n">__global</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">image</span><span class="p">,</span>
<span class="w">                              </span><span class="n">__global</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">pixel_color</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">int</span><span class="w"> </span><span class="n">pixel_size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pixel_size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">tex_coord_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coord</span><span class="p">[</span><span class="n">gid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">tex_coord_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coord</span><span class="p">[</span><span class="n">gid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">u_img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">tex_coord_x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">v_img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="mf">1.0f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tex_coord_y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">v_img</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_img</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>
<span class="w">        </span><span class="n">pixel_color</span><span class="p">[</span><span class="n">gid</span><span class="o">*</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<span class="w">        </span><span class="n">pixel_color</span><span class="p">[</span><span class="n">gid</span><span class="o">*</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G</span><span class="p">;</span>
<span class="w">        </span><span class="n">pixel_color</span><span class="p">[</span><span class="n">gid</span><span class="o">*</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="p">)</span><span class="s">&quot;;</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">140.0</span><span class="p">;</span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">command_line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="w">   </span><span class="c1">// [Loading model] Load .obj File</span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">root_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;GPGPUSIM_ROOT&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">loadout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_load_model</span><span class="p">(</span><span class="n">root_dir</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/app/rasterizer/models/triangle/three_triangulated.obj&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// [Texture]</span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">obj_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root_dir</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/app/rasterizer/models/spot/&quot;</span><span class="p">;</span>
<span class="w">   </span><span class="k">auto</span><span class="w"> </span><span class="n">texture_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;kitty.jpg&quot;</span><span class="p">;</span>

<span class="w">   </span><span class="n">api_texture</span><span class="p">(</span><span class="n">obj_path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">texture_path</span><span class="p">);</span>

<span class="w">   </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3f</span><span class="w"> </span><span class="n">eye_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">};</span>

<span class="w">   </span><span class="c1">//api_set_vertex_shader(vertex_shader);</span>
<span class="w">   </span><span class="n">api_set_fragment_shader</span><span class="p">(</span><span class="s">&quot;normal_fragment_shader&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">frag_shader_source2</span><span class="p">);</span>

<span class="w">   </span><span class="n">api_set_model</span><span class="p">(</span><span class="n">get_model_matrix</span><span class="p">(</span><span class="n">angle</span><span class="p">));</span>
<span class="w">   </span><span class="n">api_set_view</span><span class="p">(</span><span class="n">get_view_matrix</span><span class="p">(</span><span class="n">eye_pos</span><span class="p">));</span>
<span class="w">   </span><span class="n">api_set_projection</span><span class="p">(</span><span class="n">get_projection_matrix</span><span class="p">(</span><span class="mf">45.0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">));</span>

<span class="w">   </span><span class="n">api_draw</span><span class="p">();</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The output as following:
<img alt="smoke" src="../../_images/2023-10-26_123329.png" /></p>
</section>
</section>
</section>
</section>
<section id="mvp-v3-0-modeling">
<h3>4.2 MVP V3.0 Modeling<a class="headerlink" href="#mvp-v3-0-modeling" title="Link to this heading"></a></h3>
<section id="arcitecture-and-resource-overview">
<h4>4.2.1 Arcitecture and Resource Overview<a class="headerlink" href="#arcitecture-and-resource-overview" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>There are 6 GPCs, each GPC has 8 TPCs，each TPC has 2 SMs, and each SM has 4 SPs</p></li>
<li><p>Each SP contains 16 INT32 unit, <strong>16 FP32 unit</strong>, 16 LDST unit and 4 SFUs</p></li>
</ul>
<p><img alt="V3.0" src="../../_images/mvp-v3.0-architecture.png" /></p>
<p>Below shows the comparison of MVP v2.0 and MVP v3.0 from high level structure and performance</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">GPC</th>
<th style="text-align: left;">TPC</th>
<th style="text-align: left;">SM</th>
<th style="text-align: left;">SP</th>
<th style="text-align: left;">FP32 unit</th>
<th style="text-align: left;">FP32 (tflops)</th>
<th style="text-align: left;">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">MVP v3.0</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">48</td>
<td style="text-align: left;">96</td>
<td style="text-align: left;">384</td>
<td style="text-align: left;">6144</td>
<td style="text-align: left;">12.288</td>
<td style="text-align: left;">48x</td>
</tr>
<tr>
<td style="text-align: left;">MVP v2.0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">128</td>
<td style="text-align: left;">0.256</td>
<td style="text-align: left;">-</td>
</tr>
</tbody>
</table>
<p><img alt="configvsa100" src="../../_images/mvp-config-comparision.png" /></p>
<p>Below shows the memory related comparison in total</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">Memory</th>
<th style="text-align: left;">MVP v2.0</th>
<th style="text-align: left;">MVP v3.0</th>
<th style="text-align: left;">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Thread</td>
<td style="text-align: left;">2048</td>
<td style="text-align: left;">98304</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">Register file(KB)</td>
<td style="text-align: left;">128</td>
<td style="text-align: left;">6144</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">L1 Inst Cache(KB)</td>
<td style="text-align: left;">288</td>
<td style="text-align: left;">13824</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">L1 Data Cache(KB)</td>
<td style="text-align: left;">64</td>
<td style="text-align: left;">3072</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">Local memory(KB)</td>
<td style="text-align: left;">1024</td>
<td style="text-align: left;">49152</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">L2 Cache(KB)</td>
<td style="text-align: left;">2048</td>
<td style="text-align: left;">98304</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">DRAM</td>
<td style="text-align: left;">DDR4</td>
<td style="text-align: left;">HBM2</td>
<td style="text-align: left;">TBD</td>
</tr>
<tr>
<td style="text-align: left;">Memory Interface (bit)</td>
<td style="text-align: left;">256</td>
<td style="text-align: left;">4096</td>
<td style="text-align: left;">16x256 DDR4</td>
</tr>
<tr>
<td style="text-align: left;">Memory Data Rate (MHz)</td>
<td style="text-align: left;">800</td>
<td style="text-align: left;">1000</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Memory Bandwidth (GB/s)</td>
<td style="text-align: left;">51.2</td>
<td style="text-align: left;">1024</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Memory Size (GB)</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">16x2  DDR4</td>
</tr>
</tbody>
</table>
<p><img alt="memoryvsa100" src="../../_images/mvp-memory-comparison.png" /></p>
</section>
<section id="id7">
<h4>4.2.2 并行计算方式<a class="headerlink" href="#id7" title="Link to this heading"></a></h4>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">优点</th>
<th style="text-align: left;">缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SMT</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">SMT + SIMT</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">SMT + SIMT + SIMD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">SIMT</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">SMT + SIMD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<section id="smt">
<h5>4.2.2.1 SMT<a class="headerlink" href="#smt" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>保持当前的SMT设计，扩展为16个ALU/SP，即16个独立PC。</p></li>
<li><p>进行流水线的优化，添加ibuffer, operand_collector，支持2-issue，降低stall概率，提升并行性和占用率</p></li>
</ul>
</section>
<section id="smt-simt-simd">
<h5>4.2.2.2 SMT + SIMT/SIMD<a class="headerlink" href="#smt-simt-simd" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>保持当前SMT设计的基础上，每个PC对应支持4个ALU，即4个ALU共享同一个PC，该4个ALU按SIMT模式运行</p></li>
<li><p>在该设计下，保持了SMT的灵活性，同时增加了吞吐率，4 SMT X 4 SIMT = 16</p></li>
</ul>
</section>
<section id="simt">
<h5>4.2.2.3 SIMT<a class="headerlink" href="#simt" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>将当前的SMT模式改为SIMT模式，即每个SP只有一个PC，16个ALU共享同一个PC</p></li>
</ul>
</section>
</section>
<section id="way-of-work">
<h4>4.2.3 Way of Work<a class="headerlink" href="#way-of-work" title="Link to this heading"></a></h4>
<p><img alt="V3.0" src="../../_images/mvp-v3.0-architecture-design-1.png" /></p>
<blockquote>
<div><p>The basic unit of pixel-fragment shader processing is the 2 x 2 pixel quad. The SM controller groups eight pixel quads into a warp of 32 threads. It similarly groups vertices and primitives into warps and packs 32 computing threads into a warp
The texture unit processes one group of four threads(vertex, geometry, pixel, or compute) per cycle</p>
</div></blockquote>
</section>
<section id="id8">
<h4>4.2.4 Pipeline<a class="headerlink" href="#id8" title="Link to this heading"></a></h4>
<p>流水线的设计思路：</p>
<ol class="arabic simple">
<li><p>Peak算力（FLOPS）的提升是由硬件的FU数量及主频决定的</p></li>
<li><p>实际算力是由FU的占用率来决定，而占用率是由调度决定</p></li>
<li><p>调度可通过多发射，动态调度，海量线程等技术提升占用率</p></li>
</ol>
<p><img alt="V3.0" src="../../_images/mvp-v3.0-sp-pipeline.png" /></p>
<p>目前的设计中，在FE\IS\RF阶段都有Decoder。</p>
<ul class="simple">
<li><p>流水线中支持的V线程（Warp数）需要结合流水级数确定，否则在前后指令有数据依赖时会有流水线stall的情况</p></li>
</ul>
<section id="fe-stage">
<h5>4.2.4.1 FE Stage<a class="headerlink" href="#fe-stage" title="Link to this heading"></a></h5>
<p>当前设计中，如果stall了，FE阶段不会取指，但是如果添加一个ibuffer，用来缓存FE取到的指令，那么FE就不会stall，每个cycle都可以取指并放入ibuffer中。IS阶段直接从ibuffer中选择指令。从而提高流水线的并发性，提升性能。</p>
<p>按照当前设计，如下指令在FE阶段完成并退出流水线</p>
<ul class="simple">
<li><p>break</p></li>
<li><p>exit</p></li>
<li><p>exret</p></li>
<li><p>sync</p></li>
</ul>
</section>
<section id="is-stage">
<h5>4.2.4.2 IS Stage<a class="headerlink" href="#is-stage" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p>添加scoreboard来记录需要写入的目的寄存器，以支持乱序发射。从ibuffer中取出的指令，如果其源寄存器或目的寄存器不在scoreboard中，那么该指令不依赖前一条指令，可以继续执行进入RF阶段，否则该指令不能进入RF阶段。同时做相关的结构冲突检测</p></li>
<li><p>支持寄存器重命名，由于当前指令集最大支持32个寄存器，而在微架构的体系结构中的寄存器数量大于实际指令集中用的寄存器数量。因此可以利用寄存器重命名技术来解决WAW和WAR这类name dependences，以提升性能</p></li>
</ol>
</section>
<section id="rf-stage">
<h5>4.2.4.3 RF Stage<a class="headerlink" href="#rf-stage" title="Link to this heading"></a></h5>
<p>进入RF阶段的指令需要从寄存器文件中获取源寄存器的值，但由于寄存器文件的结构可能会出现bank冲突，因此可以增加Operand_Collector以缓存暂时由于Register File Bank冲突导致的暂时无法进入EX阶段的指令。当前的设计是由IS阶段将寄存器id传递给Register File，在RF阶段直接取数据，而且每次只发送4条指令，没有寄存器冲突。</p>
<p>从RF中正常拿到源寄存器值的指令进入EX阶段。</p>
</section>
<section id="ex-stage">
<h5>4.2.4.4 EX Stage<a class="headerlink" href="#ex-stage" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p>ALU指令进行运算，但计算的结果在WB阶段写会寄存器文件。如果IS阶段的scoreboard中有指令依赖该目的寄存器，可以先解除依赖（Register Forwarding），因为(正常情况下)下一个cycle该目的寄存器会被写入</p></li>
<li><p>store指令直接写入cache中，结束指令。load指令可能会由于cache miss而导致该线程被换出。目前load指令最终需要到WB阶段将数据写入目的寄存器</p></li>
<li><p>当前ldst单元是属于流水线的一部分，会stall流水线。可以考虑增加一个属于memory系统的ldst单元。将load、store指令直接送入该ldst单元，不stall流水线。load指令在ldst单元中等待cache返回，在未返回前，stall该线程。store指令理论上也需要等待write的返回（不影响线程继续执行，但线程结束前必须判断是否store已写入DDR中），否则数据可能并未真正写入DDR中。ldst单元每个cycle从L1D Cache中取read或write-ack的数据，并更新线程的状态</p></li>
<li><p>同时也可以考虑ldst单元直接回写寄存器，load指令的回写操作不需要进入WB阶段</p></li>
<li><p>支持Memory Coalescing，增加MSHR，来保存miss的memory request。当有新的memory request时，可以先检查是否会被miss的request包含，如果是则该新的请求就不在下发，避免浪费memory bandwidth。可能每个cache都需要支持</p></li>
<li><p>基于目前模拟器的结构，Tensor Core较容易支持在SP内部</p></li>
<li><p>Dispatch unit负责分派指令到相应的执行单元，消耗1个cycle</p></li>
</ol>
</section>
<section id="wb-stage">
<h5>4.2.4.5 WB Stage<a class="headerlink" href="#wb-stage" title="Link to this heading"></a></h5>
<p>执行回写寄存器的操作，回写操作可能也会出现寄存器bank冲突。因此也可以交给Operand_Collector。同时有Operand_Collector更新Scoreboard。</p>
<p>按照当前设计，如下指令在FE阶段完成并退出流水线</p>
<ul class="simple">
<li><p>所有需要写目的寄存器的指令</p></li>
</ul>
</section>
</section>
<section id="id9">
<h4>4.2.5 Memory<a class="headerlink" href="#id9" title="Link to this heading"></a></h4>
<section id="id10">
<h5>4.2.5.1 Register File<a class="headerlink" href="#id10" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p>通用寄存器和TC寄存器复用同一块寄存器空间</p></li>
<li><p>在没有TC的操作的时候，可以利用TC寄存器做Register Renaming</p></li>
</ol>
</section>
<section id="id11">
<h5>4.2.5.2 L1I Cache<a class="headerlink" href="#id11" title="Link to this heading"></a></h5>
<p>TODO</p>
</section>
<section id="id12">
<h5>4.2.5.3 L1D Cache<a class="headerlink" href="#id12" title="Link to this heading"></a></h5>
<p>TODO</p>
</section>
<section id="text-cache">
<h5>4.2.5.3 Text Cache<a class="headerlink" href="#text-cache" title="Link to this heading"></a></h5>
<p>TODO</p>
</section>
<section id="ldst">
<h5>4.2.5.4 LDST<a class="headerlink" href="#ldst" title="Link to this heading"></a></h5>
<p>增加属于Memory system的LDST单元</p>
</section>
<section id="l2-cache-shared-memory">
<h5>4.2.5.5 L2 Cache / Shared Memory<a class="headerlink" href="#l2-cache-shared-memory" title="Link to this heading"></a></h5>
<p>L2 Cache和Shared Memory共享同一块空间，可配置大小</p>
</section>
<section id="unified-l3-cache">
<h5>4.2.5.6 Unified L3 Cache<a class="headerlink" href="#unified-l3-cache" title="Link to this heading"></a></h5>
<p>每个L3 Cache对应一个DRAM，L3 Cache是全局共享的</p>
</section>
<section id="id13">
<h5>4.2.5.7 DRAM<a class="headerlink" href="#id13" title="Link to this heading"></a></h5>
<p>需要多个DRAM，一是增加位宽和带宽，二是增加容量</p>
</section>
</section>
</section>
</section>
<section id="extension">
<h2>5. Extension<a class="headerlink" href="#extension" title="Link to this heading"></a></h2>
<section id="nvarchsim">
<h3>5.1 NVArchSim<a class="headerlink" href="#nvarchsim" title="Link to this heading"></a></h3>
<p>NVArchSim Overview
<img alt="NVArchSim" src="../../_images/NVArchSim.png" /></p>
<p>英伟达发表在HPCA 21上的Industry Track文章“Need for speed Experiences Building a Trustworthy System-Level GPU Simulator”，介绍了英伟达开发内部系统级GPU模拟器NVArchSim(NVAS)过程中的一些经验，相比学术界主流的GPU通用计算模拟器GPGPU-Sim，模拟性能有数量级的提升。</p>
<p>英伟达内部的模拟器NVAS开发了七年（暂无开源计划），被用于Research Evaluation和新产品开发验证，适合单GPU和多GPU场景，相比于GPGPU-Sim，模拟性能有40~250倍的提升。</p>
<p><strong>NVAS不是Cycle accurate的，而是所谓loose Cycle Accurate。设计原则是看作多个Roofline components的动态交互</strong>。其component根据其内部设计规范Design Specification做仿真，而不是保留cycle精度的细节。大部分components根据<a class="reference external" href="https://en.wikipedia.org/wiki/Roofline_model">Roofline model</a>做模拟，而没有展现出明显的Roofline效应的component，用最小的细节去仿真。</p>
<p>NVAS的特点是</p>
<ul class="simple">
<li><p>由于GPU并行计算对延时的容忍度高，NVAS可以被设计成Loose Cycle精度的，不用去记录每个执行</p></li>
<li><p>混合Trace-driven和Instruction Driven的仿真，Trace跟踪的是SASS级别的指令</p></li>
<li><p>为了复现和调试的方便，设计成单线程</p></li>
<li><p>Event-based，不活动的components不需要去做计算。</p></li>
<li><p>各个Components只需要改变参数配置，很容易被替换成其它component</p></li>
</ul>
<p>作者只对已有NVAS进行两个修改</p>
<ol class="arabic simple">
<li><p>调节指令延迟和吞吐量信息，加入新的指令（更新了tensor core操作）</p></li>
<li><p>改变架构级参数，比如GPU不同部件间的通道延迟和带宽</p></li>
</ol>
<p>部件保证度和仿真速度的平衡</p>
<p>NVAS通过改变主频、核心数、带宽、延迟这些参数，确保改变参数后仿真的结果符合正确的趋势，从而适应未来新的硬件参数的变化</p>
<p>NVAS的高仿真速度是通过只在必要的时候保持部件的高保真度来实现的（合理使用仿真细节）。设计可插拔的部件架构，避免复杂或过于详细的公开接口，这样就可以支持相同部件的多种实现，可以开发者根据需求自由的进行替换</p>
<p>NVArchSim已经成功用于NVIDIA内部跨越几个不同的领域的GPU研究，并继续作为他们未来GPU系统研究的主要工具</p>
</section>
</section>
<section id="reference">
<h2>6. Reference<a class="headerlink" href="#reference" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#/ebook/villa2021.pdf"><span class="xref myst">Need for Speed: Experiences Building a Trustworthy System-Level GPU Simulator</span></a></p></li>
<li><p><a class="reference external" href="https://zhuanlan.zhihu.com/p/502029361">https://zhuanlan.zhihu.com/p/502029361</a></p></li>
<li><p><a class="reference external" href="https://browser.geekbench.com/opencl-benchmarks">https://browser.geekbench.com/opencl-benchmarks</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, ggangliu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>